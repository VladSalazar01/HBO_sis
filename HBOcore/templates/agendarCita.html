{% extends 'base.html' %}

{% block cta %}
<div class="container">
    <div class="row">
        <div class="col-xs-1-12">
            <p>Ingrese datos para el agendamiento de cita</p>
            <form method="post" id="agendamientoform">
                <div class="form-group">
                                     
                </div>
                <label for="first_name">Paciente: {{ user.last_name }} {{user.first_name}}</label>  

                {% csrf_token %}
                
                    {{ form.as_p }}    
                {{form.errors}}           
                
                <input type="submit" value="Agendar" class="btn btn-light btn-lg action-button" >
                <a href="/" class="btn btn-light btn-lg action-button" type="button">Cancelar</a>
                <br></br>
               
            </form>           
                           
            
        </div>
        
    </div>
</div>
    
{% endblock cta %}

{% block content %}

{% endblock content %}

{% block scripts %}

<script>//jscript para dropdown dependiente
    //mas tokens de seguridad
    function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
const csrftoken = getCookie('csrftoken');


    let especialidades_field = document.getElementById("id_especialidad");
    let medicos_field = document.getElementById("id_medico");

    especialidades_field.addEventListener ("change", getEspecialidadId);
      

            function getEspecialidadId(e){
                console.log(e.target.value)

                especialidades_id = e.target.value;

                const data = {   user_id: especialidades_id      };
                let url = " {% url 'citasMed:get_medicos' %} "

        fetch(url, {
            method: 'POST',// or 'PUT'            
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken ,                   
            },
            body: JSON.stringify(data)            
        })
        .then(response => response.json())

        .then(data =>{console.log('Success:', data);
        medicos_field.innerHTML = '<option value="" selected=""  > --seleccionar-- </option>'
        for (let i = 0; i < data.length; i++) {
            medicos_field.innerHTML += '<option value="$ {data[i]["id"]}" selected="">" $ {data[i]["numero_colegiado"]} </option>';
        }
        })
        .catch((error) => {  console.error('Error:', error);});       
                

    }
    
    let input = document.getElementById("id_name")
        let select = document.getElementsByTagName("select")
        console.log(select)

        input.classList.add("form-control")

        for(let i = 0; i <select.length; i++){
            select[i].classList.add("form-select")
        }


</script>

{% endblock scripts %}